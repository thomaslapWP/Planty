import{l,r as x,A as N,j as s,d3 as W,d4 as L,e as g,C as D,d5 as B,d6 as P,d7 as w,d8 as O,d9 as q,da as z,db as H,dc as k,dd as M,de as I,df as V,dg as G,dh as J,di as K,dj as Q,dk as X,dl as Y,dm as v,dn as Z}from"./main-1.0.7.js";import{u as A,B as T,a as $,T as U,ag as aa,b as f}from"./main-1.0.7-9bcf9658.js";import{A as ea}from"./AdminTheme-1.0.7-e1a0758c.js";import{m as ta}from"./ActionsApp-1.0.7-d5341f25.js";import{F as y,b as sa,a as C,A as R,T as _}from"./TextField-1.0.7-db52d17f.js";import{P as la,I as ra}from"./iconBase-1.0.7-dd244ceb.js";import{F as na}from"./FormControlLabel-1.0.7-e4e2218b.js";import{C as oa}from"./Checkbox-1.0.7-e4c93e2e.js";import{d as E,e as F,h as ia}from"./ActionsExplorer-1.0.7-4d40ab8a.js";const ga=({app:e,setIsUpdated:u,isRelationTable:o})=>{l.debug(e,o);const p=A(),[m,c]=x.useState(!1),h=x.useRef(!0);x.useEffect(()=>{h.current?h.current=!1:a()},[e.appDatabase,e.appTable,e.appRelationTable,p]);const a=()=>{e.appDatabase!==null&&(!o&&e.appTable!==null||o&&e.appRelationTable!==null)&&(c(!0),ta(e.appDatabase,o?e.appRelationTable??"":e.appTable??"",!1,function(n){const d=n==null?void 0:n.data;if(l.debug("response data",e.appDatabase,o?e.appRelationTable:e.appTable,d),!d.columns)g(D.contactSupport,{variant:"error"});else{const b=[];d.columns.map(j=>{j.column_name!==void 0&&b.push({columnName:j.column_name,isSelected:!0})}),p(o?B({appRelationColumns:b}):P({appColumns:b,appMetaData:d}))}c(!1)},n=>{l.error("error",n),g(n??D.contactSupport,{variant:"error"}),c(!1)}))},[r,t]=x.useState(!1);l.debug("hasErrors",r);const i=o?e.appRelationColumns:e.appColumns;return l.debug("columns",i),x.useEffect(()=>{Number(e.appType)!==N.DATATABLE&&e.appMetaData.primary_key!==void 0?t(e.appMetaData.primary_key.length===0||e.appMetaData.primary_key.filter(n=>i.filter(b=>b.isSelected).map(b=>b.isSelected?b.columnName:!1).includes(n)).length!==e.appMetaData.primary_key.length):t(!1)},[e,i]),s.jsxs(T,{sx:{position:"relative"},children:[s.jsxs(y,{fullWidth:!0,children:[s.jsxs(T,{component:"fieldset",sx:{borderWidth:1,borderRadius:"4px","& .MuiPaper-root":{border:"none",padding:"15px 20px"},"& .MuiFormHelperText-root":{marginLeft:"20px",marginBottom:"20px"}},children:[s.jsx("legend",{style:{fontSize:"0.75rem",fontWeight:400,color:"rgba(0, 0, 0, 0.6)"},children:"Select columns *"}),s.jsxs(la,{variant:"outlined",sx:{padding:"15px 30px"},children:[i.length===0&&s.jsx(y,{fullWidth:!0,sx:{margin:"5px 0"},children:s.jsx(sa,{sx:{color:"inherit"},children:"No table selected"})}),...i.map((n,d)=>{var b;return s.jsx(na,{control:s.jsx(oa,{checked:n.isSelected,onChange:(j,S)=>{p(o?W({appRelationColumns:[...e.appRelationColumns.slice(0,d),{columnName:n.columnName,isSelected:S},...e.appRelationColumns.slice(d+1)]}):L({appColumns:[...e.appColumns.slice(0,d),{columnName:n.columnName,isSelected:S},...e.appColumns.slice(d+1)]})),u&&u(!0)}}),label:s.jsx(T,{sx:{color:r&&e.appMetaData.primary_key.includes(n.columnName)?(b=ea)==null?void 0:b.palette.error.main:""},children:n.columnName+(r&&e.appMetaData.primary_key.includes(n.columnName)?" (primary key column)":"")}),sx:{width:"100%"}})})]})]}),s.jsx(C,{children:"Only selected columns are available in tables and forms. Unselected columns are excluded from responses. At least one column must be selected."}),!m&&e.appDatabase!==null&&(!o&&e.appTable!==null||!o&&e.appRelationTable!==null)&&r&&s.jsxs(C,{error:!0,sx:{marginTop:"20px",width:"fit-content",display:"inline-grid",gridTemplateColumns:"40px auto",justifyContent:"space-around",alignItems:"center"},children:[s.jsx($,{size:"24px"}),s.jsx("span",{children:e.appMetaData.primary_key.length===0?s.jsx(s.Fragment,{children:"This table contains no primary key. Transactions are not supported for tables without a primary key. Please create a primary key to continue or select app type Data Table in the app info tab."}):s.jsxs(s.Fragment,{children:["Transactions require all primary key columns to be selected. With the current settings transactions will be disabled for table ",o?e.appRelationTable:e.appTable,"."]})})]})]}),s.jsx(T,{sx:{position:"absolute",top:"15px",right:"10px"},children:s.jsx(U,{title:"Refresh column list",children:s.jsx(ra,{onClick:()=>{a()},children:s.jsx(aa,{})})})})]})},Da=({setIsUpdated:e,isDetail:u,isRelationTable:o})=>{const p=A(),m=f(t=>w(t));l.debug("appDatabase",m);const c=f(t=>O(t));l.debug("tables",c);const h=f(t=>q(t));l.debug("views",h);const a=f(t=>z(t));l.debug("appTable",a);const r=f(t=>H(t));return l.debug("appRelationTable",r),x.useEffect(()=>{m!==null&&(c.length===0||h.length===0)&&(E(m,function(t){const i=t==null?void 0:t.data;l.debug("response data",i),p(k({tables:i}))},t=>{l.error("error",t),g(t??D.contactSupport,{variant:"error"})}),F(m,function(t){const i=t==null?void 0:t.data;l.debug("response data",i),p(M({views:i}))},t=>{l.error("error",t),g(t??D.contactSupport,{variant:"error"})}))},[m]),s.jsxs(y,{sx:{width:"100%",marginTop:"8px"},children:[s.jsx(R,{options:m!==null?c.concat(h).sort():[],value:o?r:a,onChange:(t,i)=>{p(o?I({appRelationTable:i??null}):V({appTable:i??null})),e&&e(!0)},renderInput:t=>s.jsx(_,{...t,label:"Table *",variant:"outlined"}),sx:{width:"100%"}}),s.jsxs(C,{children:["Select a table from the list",u===void 0&&s.jsx(s.Fragment,{children:"Â (additional tables can be added in the Form Builder)"})]})]})},Ta=({setIsUpdated:e})=>{const u=A(),o=f(a=>G(a));l.debug("databases",o);const p=f(a=>J(a));l.debug("wpDatabase",p);const m=f(a=>K(a));l.debug("defaultDatabase",m);const c=f(a=>w(a));l.debug("appDatabase",c),x.useEffect(()=>{o.length===0?ia(function(a){const r=a==null?void 0:a.data;l.debug("response data",r);const t=[];let i="",n="";r.map(d=>{t.push(d.dbs),d.dbs_type.toLocaleLowerCase()==="wp"&&(i=d.dbs,n=d.dbs)}),t.sort((d,b)=>d.localeCompare(b,void 0,{sensitivity:"base"})),u(Q({databases:t})),u(X({wpDatabase:i})),u(Y({defaultDatabase:n})),c===null&&u(v({appDatabase:n})),l.debug(t,i,n)},a=>{l.error("error",a),g(a??D.contactSupport,{variant:"error"})}):c===null&&u(v({appDatabase:m}))},[]);const h=x.useRef(!0);return x.useEffect(()=>{h.current?h.current=!1:c!==null&&o.includes(c)&&(E(c,function(a){const r=a==null?void 0:a.data;l.debug("response data",r),u(k({tables:r}))},a=>{l.error("error",a),g(a??D.contactSupport,{variant:"error"})}),F(c,function(a){const r=a==null?void 0:a.data;l.debug("response data",r),u(M({views:r}))},a=>{l.error("error",a),g(a??D.contactSupport,{variant:"error"})}))},[c]),s.jsxs(y,{sx:{width:"100%",marginTop:"8px"},children:[s.jsx(R,{options:o,value:c,onChange:(a,r)=>{u(v({appDatabase:r??null})),e&&e(!0)},getOptionLabel:a=>p===a?a+" (WordPress database)":a,renderInput:a=>s.jsx(_,{...a,label:"Database *",variant:"outlined"}),renderOption:(a,r)=>s.jsxs(T,{component:"li",sx:{"& > img":{mr:2,flexShrink:0}},...a,children:[r," ",p===r?" (WordPress database)":""]}),sx:{width:"100%"}}),s.jsx(C,{children:"Select a database from the list"})]})},ya=()=>{const e=f(u=>Z(u));return l.debug("app",e),e};export{Ta as C,Da as a,ga as b,ya as u};
