import{l as a,j as e,s as _e,a as Ge,g as ye,b as We,A as y,r as m,e as c,C as T,c as qe,d as He,f as Ye,h as Je,i as $e,k as Ze,R as W,m as X,n as Ke,o as Ve,P as Qe,p as me,u as ve,q as Xe,t as se,v as fe,w as Ue,x as es,y as ss,z as ts,B as rs,D as as,E as is,F as be,G as je,H as ns,I as os,J as ps,K as ls,L as cs,M as ds,N as us,O as xs,Q as ae,S as hs}from"./main-1.0.7.js";import{B as q,A as H,C as le,a as ce,b as gs}from"./AdminTheme-1.0.7-e1a0758c.js";import{B as n,u as P,M as U,a as ms,b as _,c as fs,T as N,d as bs,A as Ce,e as Se,f as De,g as te,h as js,i as As,j as Ts,k as ys,l as vs,S as Cs,D as B,m as Ss,n as Ds,o as Ms,v as ks,p as Rs,q as Is,r as ws}from"./main-1.0.7-9bcf9658.js";import{T as ie,C as K,s as Es,S as de,R as Ns,a as ne,B as Ls,b as zs,c as Os,d as Bs,e as oe}from"./settings-1.0.7-0ed115b6.js";import{C as Me,a as ke,b as Re,u as ge}from"./useApp-1.0.7-3c86de8d.js";import{A as L,a as z,b as ee}from"./AccordionSummary-1.0.7-07dc4067.js";import{T as J,F as $,I as Ie,S as we,a as Z,b as ue,A as xe}from"./TextField-1.0.7-db52d17f.js";import{M as Ee}from"./MenuItem-1.0.7-c593e11a.js";import{P as Fs}from"./PremiumFeature-1.0.7-7accbda7.js";import{L as Y}from"./Link-1.0.7-7fd9c9be.js";import{a as Ps,b as _s,c as Gs,d as Ws,e as qs,f as Hs,g as Ys,h as Js,i as $s}from"./ActionsApp-1.0.7-d5341f25.js";import{R as Zs}from"./RadioGroup-1.0.7-a99aad94.js";import{R as Ae}from"./Radio-1.0.7-a1fc902e.js";import{F as he}from"./FormControlLabel-1.0.7-e4e2218b.js";import{l as Ks,C as Vs}from"./index-1.0.7-dc3cd19e.js";import{I as F,T as Te,P as Ne}from"./iconBase-1.0.7-dd244ceb.js";import{T as pe}from"./Tabs-1.0.7-766143ea.js";import{B as Q}from"./index.esm-1.0.7-8ea9dc9a.js";import{F as Qs}from"./FileSaver.min-1.0.7-fd4f2e6e.js";import{c as Xs}from"./index-1.0.7-22a4f547.js";import{S as Us,a as et,b as st}from"./Stepper-1.0.7-be2bc3e5.js";import{A as tt}from"./AppMetaData-1.0.7-862b01ed.js";import{I as rt}from"./InputAdornment-1.0.7-45f92a3b.js";import{C as at}from"./Checkbox-1.0.7-e4c93e2e.js";import"./Close-1.0.7-d2499b42.js";import"./DialogContent-1.0.7-fca1f4d6.js";import"./ActionsExplorer-1.0.7-4d40ab8a.js";import"./useSlot-1.0.7-9849c4eb.js";import"./index.esm-1.0.7-50dfbcc7.js";import"./Alert-1.0.7-7efc1ac6.js";import"./AlertTitle-1.0.7-a2e806c7.js";const it=({app:r,setIsUpdated:i})=>(a.debug(r),e.jsxs(n,{children:[e.jsx(L,{disableGutters:!0,children:e.jsx(z,{children:e.jsx(Me,{setIsUpdated:i})})}),e.jsx(L,{disableGutters:!0,children:e.jsx(z,{children:e.jsx(ke,{setIsUpdated:i})})}),e.jsx(L,{disableGutters:!0,children:e.jsx(z,{children:e.jsx(Re,{app:r,setIsUpdated:i})})})]})),Le=({app:r,hasErrors:i,setIsUpdated:t})=>{a.debug(r,i);const l=P();return e.jsx(J,{type:"text",label:"App Name",error:i,fullWidth:!0,required:!0,helperText:"App name must be unique",value:r.appName,autoFocus:!0,autoComplete:"off",onChange:o=>{l(_e({appName:o.target.value})),t&&t(!0)}})},ze=({app:r,hasErrors:i,setIsUpdated:t})=>{a.debug(r,i);const l=P();return e.jsx(J,{type:"text",label:"App Title",error:i,fullWidth:!0,required:!0,helperText:"App title describes the purpose of the app",value:r.appTitle,autoComplete:"off",onChange:o=>{l(Ge({appTitle:o.target.value})),t&&t(!0)}})},Oe=({app:r,setIsUpdated:i})=>{a.debug(r);const t=P(),l=ye();return a.debug(l),e.jsxs($,{children:[e.jsx(Ie,{variant:"outlined",children:"App Type *"}),e.jsxs(we,{MenuProps:{id:"pp-select-menu"},label:"App Type *",value:r.appType,onChange:o=>{t(We({appType:o.target.value})),i&&i(!0)},children:[...l.map(o=>{const x=o.id===y.DATATABLE||o.id===y.DATAENTRY;return e.jsx(Ee,{value:o.id,disabled:!x,children:o.text})})]}),e.jsx(Z,{children:"Select app type from drop-down list (currently supporting Data Tables and Data Administration, more types will be added later)"})]})},nt=({app:r})=>{a.debug(r);const[i,t]=m.useState(!1),[l,o]=m.useState(void 0),x=()=>{switch(l){case"form":return"Reset Form Builder?";case"theme":return"Reset Theme?";default:return"Reset Table Builder?"}};return e.jsxs(e.Fragment,{children:[e.jsxs(L,{disableGutters:!0,children:[e.jsx(z,{expandIcon:e.jsx(U,{}),children:"Reset"}),e.jsx(ee,{children:e.jsxs($,{sx:{display:"grid",gridGap:"20px"},children:[e.jsx(q,{variant:"contained",color:"primary",onClick:()=>{o(ie.TABLE),t(!0)},children:"Reset Table Builder"}),e.jsx(q,{variant:"contained",color:"primary",onClick:()=>{o(ie.FORM),t(!0)},children:"Reset Form Builder"}),e.jsx(q,{variant:"contained",color:"primary",onClick:()=>{o(ie.THEME),t(!0)},children:"Reset Theme"}),e.jsxs(Z,{sx:{display:"inline-grid",gridTemplateColumns:"20px auto",gridGap:"5px",alignItems:"center","& svg":{fontSize:"20px"}},children:[e.jsx(ms,{}),"A reset cannot be undone!"]})]})})]}),e.jsx(K,{title:x(),message:"Are you sure? This action cannot be undone!",open:i,setOpen:t,onConfirm:()=>{l!==void 0&&Es(r.appDbId,r.appCntId,l,null,null,u=>{if(u!=null&&u.code&&(u==null?void 0:u.message)!==void 0)switch(u.code){case"ok":c(u.message,{variant:"success"});break;case"info":c(u.message,{variant:"info"});break;default:c(u.message??T.contactSupport,{variant:"error"})}else a.error(u),c(T.contactSupport,{variant:"error"})},u=>{a.error("error",u),c(u??T.contactSupport,{variant:"error"})})}})]})},Be=()=>{const r=_(i=>qe(i));return a.debug("appMetaData",r),r},ot=()=>{const r=_(i=>He());return a.debug("appLanguage",r),r},Fe=({app:r,setIsUpdated:i})=>{a.debug(r);const t=P();Be();const l=ot(),o=_(h=>Ye(h));a.debug("updateSiteLanguage",o),m.useEffect(()=>{const h={appLanguage:Je.code};t($e(h))},[]);const[x,u]=m.useState(!1);return e.jsxs(n,{sx:{width:"100%"},children:[e.jsxs($,{fullWidth:!0,disabled:!0,children:[e.jsx(Ie,{variant:"outlined",children:"App Language"}),e.jsxs(we,{MenuProps:{id:"pp-select-menu"},label:"App Language",value:l,onChange:h=>{},children:[...Ze.map(h=>e.jsx(Ee,{value:h.code,children:h.language},h.code))]}),e.jsx(Z,{children:"Selected app language is applied to all (master and detail) tables and forms"})]}),!1,e.jsx($,{children:e.jsxs(Z,{component:"div",sx:{marginLeft:0},children:[e.jsx(n,{sx:{marginTop:"20px"},children:e.jsx(Y,{sx:{textDecoration:"none",cursor:"pointer"},onClick:()=>u(!x),children:"Which app information is localized?"})}),x&&e.jsxs(e.Fragment,{children:[e.jsxs(n,{sx:{marginTop:"20px"},children:[e.jsx("strong",{children:"Information provided in the selected app language:"}),e.jsxs("ul",{style:{listStyle:"disc",padding:"0 40px"},children:[e.jsx("li",{children:"Tooltips"}),e.jsx("li",{children:"Field labels"}),e.jsx("li",{children:"Field hints"}),e.jsx("li",{children:"Info and success messages"}),e.jsx("li",{children:"Most error messages"})]})]}),e.jsxs(n,{sx:{marginTop:"20px"},children:[e.jsx("strong",{children:"Information not provided in the selected language:"}),e.jsxs("ul",{style:{listStyle:"disc",padding:"0 40px"},children:[e.jsx("li",{children:"Builders, Wizards and Managers are provided in English"}),e.jsx("li",{children:"Database and server errors are not translated"})]})]}),e.jsxs(n,{sx:{marginTop:"20px",marginLeft:"40px",position:"relative","& svg":{position:"absolute",left:"-35px",top:"5px",fontSize:"25px"}},children:[e.jsx(fs,{})," If you discover any translation errors, please let us know. We are committed to improving our translations."]})]})]})}),e.jsx(Fs,{})]})},pt=({app:r,setIsUpdated:i})=>(a.debug(r),e.jsxs(n,{children:[e.jsx(L,{disableGutters:!0,children:e.jsx(z,{children:e.jsx(Le,{app:r,hasErrors:!1,setIsUpdated:i})})}),e.jsx(L,{disableGutters:!0,children:e.jsx(z,{children:e.jsx(ze,{app:r,hasErrors:!1,setIsUpdated:i})})}),e.jsx(L,{disableGutters:!0,children:e.jsx(z,{children:e.jsx(Oe,{app:r,setIsUpdated:i})})}),e.jsx(L,{disableGutters:!0,children:e.jsx(z,{children:e.jsx(Fe,{app:r,setIsUpdated:i})})}),e.jsx(nt,{app:r})]})),Pe=({setIsUpdated:r})=>{const i=P(),t=ge(),l=Be(),o=m.useMemo(()=>{const p=[];if((l==null?void 0:l.roles)!==void 0)for(const A in l.roles)p.push({key:A,value:l.roles[A]});return p},[l.roles]);a.debug(o);const x=m.useMemo(()=>{const p=[];if((l==null?void 0:l.users)!==void 0)for(const A in l.users)p.push({key:A,value:l.users[A]});return p},[l.users]);a.debug(x);const u=m.useMemo(()=>o.filter(p=>t.appRestApi.authorized_roles.includes(p.key)),[t.appRestApi.authorized_roles,o]),h=m.useMemo(()=>x.filter(p=>t.appRestApi.authorized_users.includes(p.key)),[t.appRestApi.authorized_users,x]);return e.jsxs($,{sx:{width:"100%"},children:[e.jsxs(Zs,{children:[e.jsxs(ue,{className:"align-label-radio",sx:{cursor:"pointer"},children:[e.jsx(Ae,{checked:t.appRestApi.authorization===W.AUTHORIZED,onChange:p=>{i(X({restApiActions:{...t.appRestApi,authorization:W.AUTHORIZED}})),r&&r(!0),p.stopPropagation()}}),"Authorized access only"]}),e.jsxs(n,{sx:{display:"grid",gridGap:"10px",margin:"30px 20px 25px 42px"},children:[e.jsx(xe,{multiple:!0,options:o,getOptionLabel:p=>p.value,value:u,onChange:(p,A)=>{i(X({restApiActions:{...t.appRestApi,authorized_roles:A.map(S=>S.key)}})),r&&r(!0),p.stopPropagation()},renderInput:p=>e.jsx(J,{...p,label:"Roles"})}),e.jsx(xe,{multiple:!0,options:x,getOptionLabel:p=>p.value,value:h,onChange:(p,A)=>{i(X({restApiActions:{...t.appRestApi,authorized_users:A.map(S=>S.key)}})),r&&r(!0),p.stopPropagation()},renderInput:p=>e.jsx(J,{...p,label:"Users"})})]}),e.jsxs(ue,{className:"align-label-radio",sx:{cursor:"pointer"},children:[e.jsx(Ae,{checked:t.appRestApi.authorization===W.ANONYMOUS,onChange:p=>{i(X({restApiActions:{...t.appRestApi,authorization:W.ANONYMOUS}})),r&&r(!0),p.stopPropagation()}}),"Anonymous access"]})]}),t.appRestApi.authorization===W.ANONYMOUS&&e.jsx(n,{sx:{marginTop:"10px",marginLeft:"10px"},children:e.jsx(Z,{children:"This setting allows non-authorized users to access this app"})})]})},lt=({app:r,setIsUpdated:i})=>{a.debug(r);const t=P();return e.jsxs(n,{sx:{display:"grid",gridGap:"30px"},children:[e.jsx(he,{control:e.jsx(de,{checked:r.appAddToMenu,onChange:(l,o)=>{t(Ke({appAddToMenu:o})),i&&i(!0),l.stopPropagation()}}),label:"Add App to WordPress dashboard menu",labelPlacement:"end"}),r.appAddToMenu&&e.jsx(J,{type:"text",label:"Title",fullWidth:!0,required:!0,helperText:"Title shown in WordPress dashboard menu",value:r.appMenuTitle,autoComplete:"off",onChange:l=>{t(Ve({appMenuTitle:l.target.value})),i&&i(!0),l.stopPropagation()}})]})},ct=({app:r,setIsUpdated:i})=>{a.debug(r);const t=()=>`[wpda_app app_id="${r.appDbId}"${l?' feedback="true"':""}${h?' builders="false"':""}]`,[l,o]=m.useState(!1),[x,u]=m.useState(!1),[h,p]=m.useState(!1),[A,S]=m.useState(!1),[M,I]=m.useState(t());return m.useEffect(()=>{I(t())},[l,h]),e.jsxs(n,{sx:{display:"grid",gridGap:"20px"},children:[e.jsxs(n,{children:[e.jsxs(ue,{children:["App short code",e.jsx(n,{sx:{marginLeft:"5px",display:"inline-block"},children:e.jsx(Ks.CopyToClipboard,{text:M,onCopy:()=>{c("Shortcode was copied to your clipboard",{variant:"info"})},children:e.jsx(N,{title:"Copy shortcode to clipboard",children:e.jsx(F,{children:e.jsx(bs,{})})})})})]}),e.jsx(n,{sx:{display:"grid",gridTemplateColumns:"auto auto",justifyContent:"space-between",alignItems:"center","& pre":{backgroundColor:"#ccc",padding:"4px"}},children:e.jsx("pre",{children:M})})]}),e.jsx(n,{children:e.jsxs($,{children:[e.jsx(he,{control:e.jsx(de,{checked:l,onChange:(D,k)=>{o(k),i&&i(!0),D.stopPropagation()}}),label:"Feedback",labelPlacement:"end"}),e.jsxs(Z,{component:"div",children:[e.jsx(Y,{sx:{textDecoration:"none",cursor:"pointer"},onClick:()=>{u(!x)},children:"Show authorization and usage errors"}),x&&e.jsx(n,{sx:{marginTop:"20px"},children:"Authorization and usage errors are hidden by default to prevent errors from appearing on front-end pages for unauthorized users. If you want to display authorization and usage errors, enable feedback."})]})]})}),e.jsx(n,{children:e.jsxs($,{children:[e.jsx(he,{control:e.jsx(de,{checked:h,onChange:(D,k)=>{p(k),i&&i(!0),D.stopPropagation()}}),label:"Disable builders on front-end",labelPlacement:"end"}),e.jsxs(Z,{component:"div",children:[e.jsx(Y,{sx:{textDecoration:"none",cursor:"pointer"},onClick:()=>{S(!A)},children:"Disables builder access for administrators"}),A&&e.jsx(n,{sx:{marginTop:"20px"},children:"Builder access is automatically enabled on front-end pages for administrators, allowing them to change app settings directly. Disabling builder access will remove all Table Builder and Form Builder icons from these pages. Please note that anonymous users and non-admin users cannot see these builder icons and have no access to app settings."})]})]})})]})},dt=({app:r,setIsUpdated:i})=>(a.debug(r),e.jsxs(n,{children:[e.jsxs(L,{disableGutters:!0,children:[e.jsx(z,{expandIcon:e.jsx(U,{}),children:"Authorize Roles & Users"}),e.jsx(ee,{children:e.jsx(Pe,{setIsUpdated:i})})]}),e.jsxs(L,{disableGutters:!0,children:[e.jsx(z,{expandIcon:e.jsx(U,{}),children:"Back-end Access"}),e.jsx(ee,{children:e.jsx(lt,{app:r,setIsUpdated:i})})]}),e.jsxs(L,{disableGutters:!0,children:[e.jsx(z,{expandIcon:e.jsx(U,{}),children:"Front-end Access"}),e.jsx(ee,{children:e.jsx(ct,{app:r,setIsUpdated:i})})]})]})),ut=({appDbId:r})=>{var j,O;a.debug(r);const i=P(),t=ge(),l=((j=H)==null?void 0:j.palette.mode)===Qe.LIGHT?(O=H)==null?void 0:O.palette.primary.main:"",[o,x]=m.useState(!1);a.debug(o);const[u,h]=m.useState(!1);a.debug(u);const p=()=>{i(ve({}))},A=()=>{o?h(!0):p()},S=()=>t.appName?t.appTitle?t.appDatabase?t.appTable?t.appColumns.filter(b=>b.isSelected).length===0?(c("At least one column must be selected",{variant:"error"}),!1):!0:(c("Table is required",{variant:"error"}),!1):(c("Database is required",{variant:"error"}),!1):(c("App title is required",{variant:"error"}),!1):(c("App name is required",{variant:"error"}),!1),M=()=>{S()&&Ps(t,b=>{if(a.debug(b),b!=null&&b.code&&(b==null?void 0:b.message)!==void 0)switch(b.code){case"ok":c(b.message,{variant:"success"}),i(se({}));break;case"info":c(b.message,{variant:"info"});break;default:a.error(b),c(b.message??T.contactSupport,{variant:"error"})}else a.error(b),c(T.contactSupport,{variant:"error"})},b=>{a.error("error",b),c(b??T.contactSupport,{variant:"error"})})},I=()=>{S()&&(M(),p())},D=b=>{i(Xe({anchor:b}))},[k,G]=m.useState("1"),f=(b,s)=>{G(s)};return e.jsxs(e.Fragment,{children:[e.jsxs(Ns,{closeDrawer:A,children:[e.jsx(Ce,{position:"static",elevation:4,sx:{borderRadius:0},children:e.jsxs(Se,{className:"pp-setting-toolbar",sx:{borderRadius:0},children:[e.jsxs(n,{sx:{flexGrow:1},children:[e.jsx(Te,{variant:"h5",noWrap:!0,component:"div",className:"unselectable",sx:{display:{xs:"none",sm:"block"},paddingLeft:"6px"},children:"Manage App"}),e.jsx(Te,{sx:{fontSize:"10px",display:{xs:"none",sm:"block"},paddingLeft:"10px"},children:t.appName})]}),e.jsx(ne,{title:"Dock to left",position:"bottom",children:e.jsx(F,{onClick:()=>{D(me.LEFT)},size:"large",color:"inherit",sx:{fontSize:"1em"},children:e.jsx(Ls,{})})}),e.jsx(ne,{title:"Dock to right",position:"bottom",children:e.jsx(F,{onClick:()=>{D(me.RIGHT)},size:"large",color:"inherit",sx:{fontSize:"1em"},children:e.jsx(zs,{})})}),e.jsx(ne,{title:"Close",position:"bottom",children:e.jsx(F,{onClick:A,size:"large",color:"inherit",sx:{fontSize:"1.4em"},children:e.jsx(De,{})})})]})}),e.jsx(le,{className:"pp-settings-container",children:e.jsx(ce,{sx:{padding:0,margin:0},children:e.jsxs(Os,{value:k,children:[e.jsxs(Bs,{variant:"fullWidth",textColor:"primary",onChange:f,sx:{width:"100%",height:"80px",padding:0,margin:0,backgroundColor:"rgb(242, 242, 242)"},children:[e.jsx(pe,{label:"App Info",value:"1",sx:{fontWeight:"bold",fontSize:"110%",height:"80px"}}),e.jsx(pe,{label:"Data Source",value:"2",sx:{fontWeight:"bold",fontSize:"110%",height:"80px"}}),e.jsx(pe,{label:"Access",value:"3",sx:{fontWeight:"bold",fontSize:"110%",height:"80px"}})]}),e.jsxs(n,{sx:{margin:0,padding:0,overflowY:"auto",height:"calc(100vh - 250px)","& > div.MuiTabPanel-root":{padding:0}},children:[e.jsx(oe,{value:"1",children:e.jsx(pt,{app:t,setIsUpdated:x})}),e.jsx(oe,{value:"2",children:e.jsx(it,{app:t,setIsUpdated:x})}),e.jsx(oe,{value:"3",children:e.jsx(dt,{app:t,setIsUpdated:x})})]})]})})}),e.jsx(le,{className:"pp-setting-footer",sx:{borderRadius:0,backgroundColor:l},children:e.jsxs(ce,{className:"pp-setting-footer-buttons",sx:{borderRadius:0},children:[e.jsx(q,{variant:"outlined",className:"footer_action_button_apply",onClick:M,children:"Apply"}),e.jsx(q,{variant:"outlined",className:"footer_action_button",onClick:I,children:"OK"}),e.jsx(q,{variant:"outlined",className:"footer_action_button",onClick:A,children:"Cancel"})]})})]}),e.jsx(K,{title:"Close App Manager?",message:"All uncommitted changes will be lost!",open:u,setOpen:h,onConfirm:()=>{p()},onKeep:()=>{p()}})]})},xt=({app:r})=>{var G,f,j,O,b;a.debug(r);const i=P(),[t,l]=m.useState(!1),[o,x]=m.useState(!1),[u,h]=m.useState(!1),p=s=>{_s(s,C=>{var V,d;const R=C==null?void 0:C.data;if(a.debug("response data",R),R.app&&R.app.app&&Array.isArray(R.app.app)&&R.app.container&&Array.isArray(R.app.container)){const g=R.app.app[0],v=R.app.container[0];a.debug(g,v);let w=[];try{w=JSON.parse(v.cnt_cls)}catch(re){a.error("Invalid JSON - app columns"),a.error(re),c("Invalid JSON, check console",{variant:"error"})}let E={};try{E=JSON.parse(g.app_settings)}catch(re){E.rest_api={authorization:W.AUTHORIZED,authorized_roles:[],authorized_users:[]},a.error("Invalid JSON - app settings"),a.error(re),c("Invalid JSON, check console",{variant:"error"})}i(es({appDbId:s,appId:ss(s),appName:g.app_name,appTitle:g.app_title,appType:g.app_type,appCntId:v.cnt_id,appCntSeqNr:v.cnt_seq_nr,appDatabase:v.cnt_dbs,appTable:v.cnt_tbl,appColumns:w,appRelationTable:null,appRelationColumns:[],appRestApi:E==null?void 0:E.rest_api,appAddToMenu:g.app_add_to_menu!=="0",appMenuTitle:((V=E==null?void 0:E.settings)==null?void 0:V.app_menu_title)??g.app_title,appMetaData:R,appLanguage:(d=E==null?void 0:E.settings)==null?void 0:d.app_language}))}else c(T.contactSupport,{variant:"error"})},C=>{a.error("error",C),c(C??T.contactSupport,{variant:"error"})})},A=()=>{switch(r.appType){case y.DATAENTRY:return e.jsx(Q,{});case y.MASTERDETAIL:return e.jsx(Q,{});case y.REGISTRATION:return e.jsx(Q,{});case y.UPDATEFORM:return e.jsx(Q,{});default:return e.jsx(Q,{})}},S=()=>{Gs(r.appId,s=>{if(a.debug(s),s!=null&&s.code&&(s==null?void 0:s.message)!==void 0)switch(s.code){case"ok":c(s.message,{variant:"success"}),i(se({}));break;case"info":c(s.message,{variant:"info"});break;default:a.error(s),c(s.message??T.contactSupport,{variant:"error"})}else a.error(s),c(T.contactSupport,{variant:"error"});x(!1)},s=>{a.error("error",s),c(s??T.contactSupport,{variant:"error"}),x(!1)})},M=()=>{Ws(r.appId,s=>{a.debug(s),s!=null&&s.code&&(s==null?void 0:s.message)!==void 0?s.data.data?Qs(new Blob([s.data.data],{type:"text/json;charset=utf-8"}),"wpda-export-"+r.appName+".sql"):(a.error(s),c(s.message??T.contactSupport,{variant:"error"})):(a.error(s),c(T.contactSupport,{variant:"error"})),x(!1)},s=>{a.error("error",s),c(s??T.contactSupport,{variant:"error"}),x(!1)})},I=()=>{qs(r.appId,s=>{if(a.debug(s),s!=null&&s.code&&(s==null?void 0:s.message)!==void 0)switch(s.code){case"ok":c(s.message,{variant:"success"}),i(se({}));break;case"info":c(s.message,{variant:"info"});break;default:a.error(s),c(s.message??T.contactSupport,{variant:"error"})}else a.error(s),c(T.contactSupport,{variant:"error"});l(!1)},s=>{a.error("error",s),c(s??T.contactSupport,{variant:"error"}),l(!1)})},D=te("(max-width:700px)"),k=te("(max-width:900px)");return e.jsxs(e.Fragment,{children:[e.jsxs(n,{sx:{display:"grid",gridTemplateColumns:"auto auto",justifyContent:"space-between",alignItems:"center",padding:"24px",...k&&{".pp-row-actions":{width:0}},"&:hover":{".pp-row-title":{display:k?"inline-block":"none"},".pp-row-actions":{visibility:k?"hidden":"visible"}}},children:[e.jsxs(n,{sx:{display:"grid",gridTemplateColumns:"auto auto",alignItems:"center"},children:[e.jsxs(n,{sx:{width:"100%",display:"grid",gridTemplateColumns:"auto 1fr",gridGap:"10px",justifyContent:"center",alignItems:"center"},children:[e.jsx(n,{children:A()}),e.jsxs(n,{sx:{textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden"},children:[r.appName,e.jsxs(n,{className:"pp-row-title",sx:{display:"inline-block",marginLeft:"5px",fontSize:"80%"},children:["−",e.jsx(n,{sx:{display:"inline-block",width:"5px"}}),r.appTitle]})]})]}),e.jsxs(n,{sx:{display:"grid",visibility:"hidden",gridTemplateColumns:"auto auto auto auto auto auto",gridGap:"10px",marginLeft:"10px",alignItems:"center"},className:"pp-row-actions",children:[e.jsx(n,{sx:{borderLeft:"1px solid black",height:"100%"}}),e.jsx(N,{title:"Manage App",children:e.jsx(Y,{sx:{cursor:"pointer"},underline:"none",onClick:s=>{p(r.appId),s.preventDefault(),s.stopPropagation()},children:"Manage"})}),e.jsx(n,{sx:{borderLeft:"1px solid black",height:"100%"}}),e.jsx(N,{title:"Run & Build App",children:e.jsx(Y,{sx:{cursor:"pointer"},underline:"none",onClick:s=>{i(fe({isActive:!0,appDbId:r.appId})),s.preventDefault(),s.stopPropagation()},children:"Run & Build"})}),e.jsx(n,{sx:{borderLeft:"1px solid black",height:"100%"}}),e.jsx(N,{title:"Delete App",children:e.jsx(Y,{sx:{cursor:"pointer"},underline:"none",onClick:s=>{l(!0),s.preventDefault(),s.stopPropagation()},children:"Delete"})})]})]}),e.jsxs(n,{sx:{display:"grid",gridTemplateColumns:"auto auto auto auto auto auto",justifyContent:D?"end":"space-evenly",alignItems:"center"},children:[e.jsx(n,{sx:{paddingRight:"10px"},children:D?"":Ue(r.appType)}),e.jsx(N,{title:"Manage App",children:e.jsx(F,{sx:{color:(G=H)==null?void 0:G.palette.primary.main},onClick:s=>{p(r.appId),s.preventDefault(),s.stopPropagation()},children:e.jsx(js,{})})}),e.jsx(N,{title:"Run & Build App",children:e.jsx(F,{sx:{color:(f=H)==null?void 0:f.palette.primary.main},onClick:s=>{i(fe({isActive:!0,appDbId:r.appId})),s.preventDefault(),s.stopPropagation()},children:e.jsx(As,{})})}),e.jsx(N,{title:"Copy App",children:e.jsx(F,{sx:{color:(j=H)==null?void 0:j.palette.primary.main},onClick:s=>{x(!0),s.preventDefault(),s.stopPropagation()},children:e.jsx(Ts,{})})}),e.jsx(N,{title:"Export App",children:e.jsx(F,{sx:{color:(O=H)==null?void 0:O.palette.primary.main},onClick:s=>{h(!0),s.preventDefault(),s.stopPropagation()},children:e.jsx(ys,{})})}),e.jsx(N,{title:"Delete App",children:e.jsx(F,{sx:{color:(b=H)==null?void 0:b.palette.error.main},onClick:s=>{l(!0),s.preventDefault(),s.stopPropagation()},children:e.jsx(vs,{})})})]})]}),o&&e.jsx(K,{title:"Please confirm",message:"Copy this app including all containers?",open:o,setOpen:x,onConfirm:()=>S()}),u&&e.jsx(K,{title:"Please confirm",message:"Export this app including all containers?",open:u,setOpen:h,onConfirm:()=>M()}),t&&e.jsx(K,{title:"Delete App?",message:"Are you sure you want to delete app "+r.appName+"? This action cannot be undone!",open:t,setOpen:l,onConfirm:()=>I()})]})},ht=({apps:r,search:i,types:t,isLoading:l})=>{a.debug(r,i,t);const o=u=>!(!rs(u.appName+" "+u.appTitle,i)||t.length>0&&t.filter(h=>h.id===Number(u.appType)).length===0),x=r.filter(u=>o(u)?u:null);return e.jsx(Ne,{elevation:4,children:e.jsxs(n,{sx:{backgroundColor:"#fff",borderBottom:"1px solid rgba(0, 0, 0, 0.34)",borderRadius:"4px","& .MuiBox-root:first-of-type":{borderTopLeftRadius:"4px",borderTopRightRadius:"4px"},"& .MuiBox-root:hover":{backgroundColor:"rgb(242, 242, 242)"}},children:[...r.map(u=>{const h=o(u);return e.jsx(n,{className:"pp-app-details",sx:{borderTop:"1px solid rgba(0, 0, 0, 0.34)",visibility:h?"visible":"hidden",position:h?"relative":"fixed"},children:e.jsx(xt,{app:u})})}),x.length===0&&e.jsx(n,{sx:{padding:"35px",borderTop:"1px solid rgba(0, 0, 0, 0.34)",borderRadius:"4px"},children:l?e.jsx(Cs,{title:"Loading apps...",align:ts.LEFT}):e.jsx(n,{children:"No apps found"})})]})})},gt=({setMode:r})=>{const i=P(),t=ge(),l=["App info","Data source","Authorization"],[o,x]=m.useState(0),[u,h]=m.useState(!1);m.useEffect(()=>{let f=null;switch(t.appType){case y.DATATABLE:f=W.ANONYMOUS;break;case y.DATAENTRY:case y.MASTERDETAIL:case y.REGISTRATION:case y.UPDATEFORM:case y.APPCONTAINER:f=W.AUTHORIZED;break}f!==null?i(X({restApiActions:as(f)})):c(T.contactSupport,{variant:"error"})},[t.appType]);const[p,A]=m.useState({appName:!1,appTitle:!1,appDatabase:!1,appTable:!1,appColumns:!1});a.debug(p);const S=()=>{const f=Xs(is);f.table.transactions.insert=Number(t.appType)===y.DATAENTRY||Number(t.appType)===y.MASTERDETAIL||Number(t.appType)===y.REGISTRATION,f.table.transactions.update=Number(t.appType)===y.DATAENTRY||Number(t.appType)===y.MASTERDETAIL||Number(t.appType)===y.UPDATEFORM,f.table.transactions.delete=Number(t.appType)===y.DATAENTRY||Number(t.appType)===y.MASTERDETAIL,Hs(t,f,j=>{if(a.debug(j),j!=null&&j.code&&(j==null?void 0:j.message)!==void 0)switch(j.code){case"ok":c(j.message,{variant:"success"}),r(B.TABLE),i(se({}));break;case"info":c(j.message,{variant:"info"});break;default:a.error(j),c(j.message??T.contactSupport,{variant:"error"})}else a.error(j),c(T.contactSupport,{variant:"error"})},j=>{a.error("error",j),c(j??T.contactSupport,{variant:"error"})}),t.updateSiteLanguage&&t.appLanguage!==void 0&&Ys(t.appLanguage,()=>{},()=>{})},M=()=>{var j,O;let f=!0;if(o===0){let b=!1,s=!1;t.appName.trim()===""&&(c("App name is required",{variant:"error"}),b=!0,f=!1),t.appTitle.trim()===""&&(c("App title is required",{variant:"error"}),s=!0,f=!1),A({...p,appName:b,appTitle:s})}if(o===1){let b=!1,s=!1,C=!1;((j=t.appDatabase)==null?void 0:j.trim())===""&&(c("Database is required",{variant:"error"}),b=!0,f=!1),((O=t.appTable)==null?void 0:O.trim())===""&&(c("Table is required",{variant:"error"}),s=!0,f=!1),t.appColumns.filter(R=>R.isSelected===!0).length===0&&(c("No columns selected",{variant:"error"}),C=!0,f=!1),A({...p,appDatabase:b,appTable:s,appColumns:C})}return o===2&&S(),a.debug(f),f},I=()=>e.jsxs(n,{sx:{textAlign:"right",display:"grid",gridTemplateColumns:"auto auto",justifyContent:"space-between",alignItems:"center"},children:[o>0?e.jsx(q,{variant:"outlined",size:"medium",sx:{width:"160px",marginRight:"10px"},onClick:()=>{x(o-1)},startIcon:e.jsx(Ss,{}),children:e.jsx(n,{children:"Back"})}):e.jsx(n,{}),e.jsx(q,{variant:"contained",size:"medium",sx:{width:"160px"},onClick:()=>{M()&&o<2&&x(o+1)},startIcon:o>=2&&e.jsx(Ds,{}),endIcon:o<2&&e.jsx(Ms,{}),children:e.jsx(n,{children:o<2?"Next":"Finish"})})]}),D=()=>e.jsxs(e.Fragment,{children:[e.jsx(Le,{app:t,hasErrors:p.appName}),e.jsx(ze,{app:t,hasErrors:p.appName}),e.jsx(Oe,{app:t}),e.jsx(Fe,{app:t}),I()]}),k=()=>e.jsxs(e.Fragment,{children:[e.jsx(Me,{}),e.jsx(n,{sx:{display:t.appDatabase?"block":"none"},children:e.jsx(ke,{})}),e.jsx(n,{sx:{display:t.appTable?"block":"none"},children:e.jsx(Re,{app:t})}),I()]}),G=()=>e.jsxs(e.Fragment,{children:[e.jsx(n,{children:e.jsx(Pe,{})}),I()]});return e.jsxs(e.Fragment,{children:[e.jsxs(le,{sx:{padding:"50px 70px 40px 70px",display:"grid",gridGap:"40px"},elevation:4,children:[e.jsxs(n,{sx:{display:"grid",gridTemplateColumns:"auto auto",justifyContent:"space-between",alignItems:"start"},children:[e.jsx(Vs,{title:"App Wizard",subheader:"Add new app",sx:{padding:0}}),e.jsx(n,{children:e.jsx(N,{title:"Close",children:e.jsx(Y,{sx:{cursor:"pointer"},underline:"none",onClick:f=>{h(!0),f.preventDefault(),f.stopPropagation()},children:e.jsx(n,{sx:{fontSize:"1.5rem",color:"#000"},children:e.jsx(De,{})})})})})]}),e.jsxs(ce,{sx:{padding:0,display:"grid",gridGap:"30px"},children:[e.jsx(Us,{activeStep:o,sx:{margin:"10px 0 30px 0"},children:l.map((f,j)=>(a.debug(f,j),e.jsx(et,{children:e.jsx(st,{children:f})},f)))}),e.jsxs("form",{onSubmit:f=>(f.preventDefault(),M()&&x(o+1),!1),style:{display:"grid",gridGap:"40px"},children:[o===0&&D(),o===1&&k(),o===2&&G(),e.jsx("input",{type:"submit",style:{display:"none"}})]})]})]}),e.jsx(K,{title:"Close App Wizard?",message:"All uncommitted changes will be lost!",open:u,setOpen:h,onConfirm:()=>{r(B.TABLE)}})]})};const $t=()=>{const r=P(),i=m.useMemo(()=>ks(),[]),[t,l]=m.useState(B.TABLE);a.debug(t),m.useEffect(()=>{const d=localStorage.getItem("ppAppsDbsSearch");d!==null&&r(be({dbSearch:d}));const g=localStorage.getItem("ppAppsDbsSearchType");if(g!==null){const v=JSON.parse(g);r(je({dbTypes:v}))}},[]);const o=_(d=>ns(d));a.debug("apps",o);const x=_(d=>os(d));a.debug("appDbId",x);const u=_(d=>ps(d));a.debug("dbSearch",u);const h=_(d=>ls(d));a.debug("dbTypes",h);const p=_(d=>cs(d));a.debug("designMode",p);const A=_(d=>ds(d));a.debug("reload",A);const[S,M]=m.useState(!0);m.useEffect(()=>{D(),I()},[A]);const I=()=>{Js(function(d){const g=d==null?void 0:d.data;if(a.debug("response data",g),Array.isArray(g)){const v=[];for(let w=0;w<g.length;w++)v.push({appId:g[w].app_id,appName:g[w].app_name,appTitle:g[w].app_title,appType:g[w].app_type,appSettings:g[w].app_settings,appAddToMenu:g[w].app_add_to_menu});r(ae({appList:v}))}else a.error(g),c((g==null?void 0:g.message)??T.contactSupport,{variant:"error"}),r(ae({appList:[]}));M(!1)},d=>{a.error("error",d),c(d??T.contactSupport,{variant:"error"}),r(ae({appList:[]})),M(!1)})},D=()=>{$s(function(d){const g=d==null?void 0:d.data;a.debug("response data",g),r(hs({appMetaData:g}))},d=>{a.error("error",d),c(d??T.contactSupport,{variant:"error"})})};m.useEffect(()=>{t===B.TABLE&&D()},[t]),m.useEffect(()=>{us.appPlugin&&(t===1||p.isActive===!0&&p.appDbId>0?window.document.documentElement.style.setProperty("--addAppIconVisibility","hidden"):window.document.documentElement.style.setProperty("--addAppIconVisibility","visible"),window.ppActionCreateApp=function(){t===0&&!(p.isActive===!0&&p.appDbId>0)&&l(B.FORM)})},[t,p]);const[k,G]=m.useState(250),f=te("(max-width: 600px)"),j=te("(max-width: 900px)");m.useEffect(()=>{s.current&&G(s.current.offsetWidth)},[h]);const O=gs(),b=ye();a.debug(b);const s=m.useRef(),C=()=>p.isActive===!0&&p.appDbId>0,R=()=>e.jsx(N,{title:"Add new app",children:e.jsx(F,{sx:{color:"inherit"},onClick:()=>{r(ve({})),l(B.FORM)},children:e.jsx(ws,{})})}),V={};return C()&&(V.visibility="hidden"),e.jsxs(Rs,{theme:O,children:[e.jsxs(n,{className:"pp-applist",sx:{width:"100%",visibility:C()?"hidden":"visible",position:C()?"fixed":"auto",height:C()?0:"auto",...C()&&{"& *":{visibility:"hidden"}},"& .pp-app-details":{...V}},children:[e.jsx(Ce,{position:"relative",elevation:4,sx:{margin:"0 0 5px 0"},children:e.jsxs(Se,{className:"pp-applist-toolbar",sx:{display:"grid",gap:"12px",paddingRight:"12px !important",...f?{gap:0,paddingRight:"10px",paddingBottom:"10px",paddingLeft:"10px","& .pp-applist-search":{gridTemplateColumns:"1fr",gridGap:"2px"}}:{...j?{gap:0,paddingRight:"10px",paddingBottom:"10px",paddingLeft:"10px","& .pp-applist-search":{justifyContent:"space-between",gridTemplateColumns:"auto 1fr"}}:{justifyContent:"space-between",gridTemplateColumns:"1fr 1fr"}}},children:[e.jsxs(n,{className:"pp-applist-title",sx:{display:"inline-grid",gridTemplateColumns:"auto auto",justifyContent:"start",alignItems:"center",gridGap:"10px"},children:[e.jsx(n,{sx:{fontSize:"18px",lineHeight:"18px",fontWeight:"bold",whiteSpace:"nowrap"},children:"Apps"}),e.jsx(n,{children:R()})]}),e.jsxs(n,{className:"pp-applist-search",sx:{display:"grid",gridTemplateColumns:"auto auto",gridGap:"10px",justifyContent:"end",alignItems:"center"},children:[e.jsx(J,{value:u,type:"search",placeholder:"Search",disabled:t===B.FORM,onChange:d=>{r(be({dbSearch:d.target.value})),localStorage.setItem("ppAppsDbsSearch",d.target.value)},sx:{backgroundColor:"#fff",fontSize:"1em",margin:0,padding:0,borderRadius:"4px","&.MuiFormControl-root.MuiTextField-root .MuiInputBase-root":{paddingRight:0},"&.MuiFormControl-root.MuiTextField-root input":{padding:"8px"}},InputProps:{startAdornment:e.jsx(rt,{position:"end",sx:{fontSize:"1.5rem",padding:0,margin:0},children:e.jsx(Is,{})})}}),e.jsx(xe,{multiple:!0,size:"small",options:b,getOptionLabel:d=>d.text,isOptionEqualToValue:(d,g)=>d.id===g.id,value:h,disableCloseOnSelect:!0,disabled:t===B.FORM,onChange:(d,g)=>{r(je({dbTypes:g.map(v=>({id:v.id,text:Object.values(xs)[v.id]}))})),localStorage.setItem("ppAppsDbsSearchType",JSON.stringify(g))},PaperComponent:({children:d})=>e.jsx(Ne,{sx:{width:`${k}px`},children:d}),renderOption:(d,g,{selected:v})=>e.jsxs("li",{...d,children:[e.jsx(at,{style:{marginRight:8},checked:v}),g.text]}),renderInput:d=>e.jsx(n,{ref:s,children:e.jsx(J,{...d,sx:{minWidth:"250px","& .MuiInputBase-root":{backgroundColor:"#fff",padding:"0",maxHeight:"39px",overflow:"hidden"},"& .MuiButtonBase-root.MuiChip-root.MuiAutocomplete-tag":{height:"auto"}},placeholder:h.length===0?"Select app types":""})})})]})]})}),t===B.TABLE&&e.jsx(ht,{apps:o,search:u,types:h,isLoading:S}),t===B.FORM&&e.jsx(gt,{setMode:l}),x!==0&&x!==void 0&&e.jsx(ut,{appDbId:x})]}),p.isActive===!0&&p.appDbId>0&&e.jsx(tt,{appId:i,appDbId:p.appDbId,designMode:!0})]})};export{$t as default};
