import{r as d,_ as S,c3 as Se,l as o,c4 as Ce,c5 as Y,c6 as se,j as r,P as De,c7 as we,aS as Me,ba as Te,aC as D,c8 as Fe,c9 as ke,ca as pe,cb as I,cc as ee,cd as Pe,ce as Ve,e as _,cf as Ae,cg as O,ch as te,ci as Oe,cj as Ye,bZ as ae,ck as Le,bd as Be}from"./main-1.0.7.js";import{b as y,a3 as ie,B as L,Z as Ne,a4 as B,S as N,u as Ue,V as ze,v as He,g as ne,J as Ge,a5 as Je,p as $e}from"./main-1.0.7-9bcf9658.js";import{C as qe,a as We,B as T,b as Ze}from"./AdminTheme-1.0.7-e1a0758c.js";import{s as Qe,u as Xe,i as oe}from"./ActionsDml-1.0.7-c9050d88.js";import{u as Ke}from"./useAppLanguage-1.0.7-7d769d48.js";import{C as Ie}from"./CardActions-1.0.7-a34c40f3.js";d.lazy(()=>S(()=>import("./TableContainer-1.0.7-a612d45b.js").then(t=>t.T),["./TableContainer-1.0.7-a612d45b.js","./main-1.0.7.js","./AdminTheme-1.0.7-e1a0758c.js","./iconBase-1.0.7-dd244ceb.js","./index.esm-1.0.7-790ca268.js","./Close-1.0.7-d2499b42.js","./TextField-1.0.7-db52d17f.js","./main-1.0.7-9bcf9658.js","./main-1.0.7-ca6efa15.css","./FormControlLabel-1.0.7-e4e2218b.js","./MenuItem-1.0.7-c593e11a.js","./settings-1.0.7-0ed115b6.js","./DialogContent-1.0.7-fca1f4d6.js","./Tabs-1.0.7-766143ea.js","./settings-1.0.7-5a196fc8.css","./Radio-1.0.7-a1fc902e.js","./Checkbox-1.0.7-e4c93e2e.js","./AlertTitle-1.0.7-a2e806c7.js","./useSlot-1.0.7-9849c4eb.js","./InputAdornment-1.0.7-45f92a3b.js","./DateTimePicker-1.0.7-ba971b5e.js","./useMobilePicker-1.0.7-72dd8d81.js","./date-time-utils-1.0.7-4bd69471.js","./dateViewRenderers-1.0.7-95ec4b9e.js","./TimePicker-1.0.7-a475013a.js","./DatePicker-1.0.7-438b5afb.js","./ScopeEnum-1.0.7-801b5acc.js","./ActionsDml-1.0.7-c9050d88.js","./useStoreTable-1.0.7-4bf15352.js","./useAppLanguage-1.0.7-7d769d48.js","./index.esm-1.0.7-50dfbcc7.js","./index-1.0.7-2cb350a7.js","./TableContainer-1.0.7-de21160f.css"],import.meta.url));d.lazy(()=>S(()=>Promise.resolve().then(()=>U),void 0,import.meta.url));d.lazy(()=>S(()=>import("./TableContainer-1.0.7-a612d45b.js").then(t=>t.T),["./TableContainer-1.0.7-a612d45b.js","./main-1.0.7.js","./AdminTheme-1.0.7-e1a0758c.js","./iconBase-1.0.7-dd244ceb.js","./index.esm-1.0.7-790ca268.js","./Close-1.0.7-d2499b42.js","./TextField-1.0.7-db52d17f.js","./main-1.0.7-9bcf9658.js","./main-1.0.7-ca6efa15.css","./FormControlLabel-1.0.7-e4e2218b.js","./MenuItem-1.0.7-c593e11a.js","./settings-1.0.7-0ed115b6.js","./DialogContent-1.0.7-fca1f4d6.js","./Tabs-1.0.7-766143ea.js","./settings-1.0.7-5a196fc8.css","./Radio-1.0.7-a1fc902e.js","./Checkbox-1.0.7-e4c93e2e.js","./AlertTitle-1.0.7-a2e806c7.js","./useSlot-1.0.7-9849c4eb.js","./InputAdornment-1.0.7-45f92a3b.js","./DateTimePicker-1.0.7-ba971b5e.js","./useMobilePicker-1.0.7-72dd8d81.js","./date-time-utils-1.0.7-4bd69471.js","./dateViewRenderers-1.0.7-95ec4b9e.js","./TimePicker-1.0.7-a475013a.js","./DatePicker-1.0.7-438b5afb.js","./ScopeEnum-1.0.7-801b5acc.js","./ActionsDml-1.0.7-c9050d88.js","./useStoreTable-1.0.7-4bf15352.js","./useAppLanguage-1.0.7-7d769d48.js","./index.esm-1.0.7-50dfbcc7.js","./index-1.0.7-2cb350a7.js","./TableContainer-1.0.7-de21160f.css"],import.meta.url));d.lazy(()=>S(()=>Promise.resolve().then(()=>U),void 0,import.meta.url));d.lazy(()=>S(()=>Promise.resolve().then(()=>U),void 0,import.meta.url));const et=t=>{const u=y(f=>Se(f,t));return o.debug("storeColumns",u),u},tt=t=>{const u=y(f=>Ce(f,t));return o.debug("moreState",u),u},at=d.lazy(()=>S(()=>import("./Row-1.0.7-2215b3ee.js"),["./Row-1.0.7-2215b3ee.js","./main-1.0.7.js","./main-1.0.7-9bcf9658.js","./iconBase-1.0.7-dd244ceb.js","./main-1.0.7-ca6efa15.css","./useAppLanguage-1.0.7-7d769d48.js","./AdminTheme-1.0.7-e1a0758c.js","./ActionsDml-1.0.7-c9050d88.js","./CardActions-1.0.7-a34c40f3.js"],import.meta.url)),nt=({appId:t,metaData:u,primaryKey:f,formMode:x,formUuid:w})=>{var R;o.debug(t,u,f,x,w);const j=ie(t),C=y(h=>Y(h,t));o.debug("data",C);const g=y(h=>se(h,t));o.debug("initialData",g);let E="30px";return r.jsx("form",{id:w,className:"pp-form-content",onSubmit:h=>(h.preventDefault(),!1),children:r.jsx(L,{className:"pp-form-grid",sx:{display:"grid",gridTemplateColumns:{lg:`repeat(${j.cellsPerRow}, 1fr)`,md:"repeat("+Math.min(j.cellsPerRow,2)+", 1fr)",xs:"1fr"},gap:E,marginBottom:0,background:j.showGrid?((R=Ne)==null?void 0:R.palette.mode)===De.LIGHT?"repeating-linear-gradient( -45deg, transparent, transparent 10px, #eee 10px, #eee 20px )":"repeating-linear-gradient( -45deg, transparent, transparent 10px, #111 10px, #111 20px )":"","& p.MuiFormHelperText-root":{...x===B.VIEW&&!0&&{display:"none"}}},children:r.jsx(d.Suspense,{fallback:r.jsx(N,{}),children:r.jsx(at,{appId:t,metaData:u,data:C,initialData:g,primaryKey:f,formMode:x,formSettings:j})})})})};var ot=we();const p=Me(ot);const rt=d.lazy(()=>S(()=>import("./Alert-1.0.7-7efc1ac6.js"),["./Alert-1.0.7-7efc1ac6.js","./main-1.0.7.js","./index.esm-1.0.7-8ea9dc9a.js","./iconBase-1.0.7-dd244ceb.js","./AlertTitle-1.0.7-a2e806c7.js","./Close-1.0.7-d2499b42.js","./useSlot-1.0.7-9849c4eb.js"],import.meta.url)),st=({appId:t,primaryKey:u,formMode:f,showTable:x,showForm:w,detailKey:j,children:C,relationAppId:g,relTab:E,joinTab:R,isEmbedded:h})=>{var X;o.debug(t,u,f,j,g,E,R,h);const b=Ue(),P=et(t),c=Ke(t),le=ze(),z=d.useMemo(()=>He(),[]),[ue,V]=d.useState(!1),[ce,H]=d.useState(!1),[G,me]=d.useState(""),a=d.useMemo(()=>Te(D.getState(),t),[t]);o.debug("metaData",a);const M=Fe((X=a==null?void 0:a.app)==null?void 0:X.container[0]),F=y(n=>Y(n,t));o.debug("data",F);const de=y(n=>se(n,t));o.debug("initialData",de);const A=y(n=>ke(n,t));o.debug("m2mUpdate",A),d.useEffect(()=>{A===!0&&k(!1,()=>{b(ee({appId:t,update:!1}))})},[A]),d.useEffect(()=>{u===null?ge():Object.keys(u).length>0?fe():V(!0)},[u]);const fe=()=>{Qe(t,u,a==null?void 0:a.media,n=>{if(o.debug(n),n!==null){const i={...n.context};delete i.debug;const l={...n.data[0]};b(I({appId:t,data:l,context:i})),V(n!==null)}else _(c.invalidResponse,{variant:"error"})},n=>{o.error("error",n),me(n??c.invalidResponse)},!1,E)},ge=()=>{var n,i;if(a.columns&&Array.isArray(a.columns)){const l={},s=pe(D.getState(),t);o.debug("defaultValues",s);for(let e=0;e<a.columns.length;e++)l[a.columns[e].column_name]=null,s[a.columns[e].column_name]!==void 0&&(s[a.columns[e].column_name]==="@wpda_wp_user_id"?l[a.columns[e].column_name]=(i=(n=a==null?void 0:a.settings)==null?void 0:n.env)==null?void 0:i.id:s[a.columns[e].column_name]==="@now"?a.columns[e]==="date"?l[a.columns[e].column_name]=p(Date.now()).format("YYYY-MM-DD"):l[a.columns[e].column_name]=p(Date.now()).format("YYYY-MM-DD HH:mm:ss"):a.columns[e].column_default!==null&&a.columns[e].column_default!==""?a.columns[e].column_default==="CURRENT_TIMESTAMP"?a.columns[e]==="date"?l[a.columns[e].column_name]=p(Date.now()).format("YYYY-MM-DD"):l[a.columns[e].column_name]=p(Date.now()).format("YYYY-MM-DD HH:mm:ss"):l[a.columns[e].column_name]=a.columns[e].column_default:l[a.columns[e].column_name]=s[a.columns[e].column_name]);o.debug(l),b(I({appId:t,data:l,context:{media:{}}})),o.debug("init"),V(!0)}},J=()=>{let n="";for(const i in a.columns)a.columns[i].extra==="auto_increment"&&(n=a.columns[i].column_name);return o.debug(n),n},_e=n=>{for(let i=0;i<a.columns.length;i++)if(a.columns[i].column_name===n)return a.columns[i]},$=n=>{const i=Ae(D.getState(),t);o.debug("rowValidation",i);let l=!1;for(const m in i)if(i[m].error===!0&&i[m].type===O.COLUMN){l=!0;break}if(l)return o.debug("validateForm returned errors"),!1;let s=!0;const e=J();for(const m in n){const v=_e(m);let K=!0;v.column_name!==e&&v.is_nullable==="NO"&&(n[m]===""&&(f===B.INSERT||be.preserveSpacesOnUpdate===!1)||n[m]===null||n[m]===void 0)&&(b(te({appId:t,columnName:m,columnError:!0,columnText:c.mandatoryField,columnType:O.FORM})),K=!1,s=!1);const ye=Oe(D.getState(),t,m);o.debug(ye),K&&b(te({appId:t,columnName:m,columnError:!1,columnText:"",columnType:O.FORM}))}return s},k=(n,i)=>{const l=Y(D.getState(),t);if(o.debug(l),$(l)){if(u!==null){const s={};Object.keys(l).map(e=>{P.map(m=>{e===m.columnName&&m.updatable&&(s[e]=l[e])})}),o.debug(s),Xe(t,u,s,e=>{var m;if(o.debug(e),e!=null&&e.code&&(e!=null&&e.message))switch(e.code){case"ok":H(!0),_(c.updatedSuccessful,{variant:"success"}),((m=e.context)==null?void 0:m.updated)!==void 0&&Object.keys(e.context.updated).map(v=>{b(Ye({appId:t,columnName:v,columnValue:e.context.updated[v]}))}),n&&(i!==void 0&&i(u),setTimeout(()=>{x(!0,g)},1e3));break;case"info":_(c.nothingToUpdate,{variant:"info"}),n&&(i!==void 0&&i(u),setTimeout(()=>{x(!0,g)},1e3));break;default:o.error(e),_(e.message??c.invalidResponse,{variant:"error"}),n&&x(!0,g)}else o.error(e),_(c.invalidResponse,{variant:"error"})},e=>{o.error("error",e),_(e??c.invalidResponse,{variant:"error"})},!1,R,E)}else oe(t,l,s=>{if(o.debug(s),s!=null&&s.code&&(s!=null&&s.message)){let e;const m={};switch(s.code){case"ok":H(!0),_(c.insertSuccessful,{variant:"success"}),e=J();for(let v=0;v<a.primary_key.length;v++)e!==""?m[a.primary_key[v]]=s.context.insert_id:m[a.primary_key[v]]=l[a.primary_key[v]];if(o.debug(m),n){i!==void 0&&i(m),x(!0,g);return}w(m,Je.UPDATE);break;default:o.error(s),_(s.message??c.invalidResponse,{variant:"error"})}}else o.error(s),_(c.invalidResponse,{variant:"error"})},s=>{o.error("error",s),_(s??c.invalidResponse,{variant:"error"})},!1,R,E);g!==void 0&&b(ee({appId:g,update:!0}))}},xe=n=>{if(n!==null&&$(F)){const i=ae(D.getState(),t),l=i.state.relation.relation_join_condition.split(",").map(e=>e.split("=")),s={...i.state.detailKey};l.map(e=>{s[e[0]]=F[e[1]]}),oe(t,s,e=>{if(o.debug(e),e!=null&&e.code&&(e!=null&&e.message))switch(e.code){case"ok":o.debug("Added relation to join table",e);break;default:o.error(e),_(e.message??c.invalidResponse,{variant:"error"})}else o.error(e),_(c.invalidResponse,{variant:"error"})},e=>{o.error(e),_(e??c.invalidResponse,{variant:"error"})},!1,!0,!1)}},ve=()=>{k(!1)},he=()=>{const n=ae(D.getState(),t);o.debug(n.state.relation),n.state.relation!==void 0&&n.state.relation.cardinality===Le.MANY_TO_MANY?k(!0,xe):k(!0)},q=()=>{x(ce,g)},be=ie(t),W=y(n=>Pe(n,t));o.debug("moreEnabled",W);const Z=tt(t);ne("(max-width: 600px)"),ne("(max-width: 900px)");const je={paddingTop:"50px",paddingBottom:"50px",paddingLeft:"50px",paddingRight:"50px"};let Re="30px",Ee="0";if(G!=="")return r.jsx(d.Suspense,{children:r.jsx(rt,{severity:"error",message:G,close:!1})});const Q=()=>r.jsx(nt,{appId:t,metaData:a,primaryKey:u,formMode:f,formUuid:z});return h?Q():r.jsx("div",{className:`${t}_wrapper pp-form`,children:ue&&F!==null?r.jsxs(qe,{sx:je,elevation:le,children:[r.jsxs(We,{sx:{padding:0,margin:"5px 0 0 0"},children:[Q(),C]}),r.jsxs(Ie,{sx:{marginTop:Re,padding:0,paddingRight:Ee,justifyContent:"space-between",alignItems:"center"},children:[r.jsxs(L,{sx:{display:"flex",gap:"8px"},children:[!1,W&&r.jsx(T,{variant:"outlined",startIcon:r.jsx(Ge,{}),onClick:()=>{b(Ve({appId:t,more:!Z}))},children:Z?c.less:c.more})]}),r.jsx(L,{children:f!==B.VIEW?r.jsxs(r.Fragment,{children:[r.jsx(T,{variant:"contained",onClick:ve,type:"submit",form:z,children:c.apply}),(M==null?void 0:M.cardinality)!==0&&r.jsxs(r.Fragment,{children:[r.jsx(T,{variant:"outlined",onClick:he,sx:{marginLeft:"8px"},children:c.ok}),r.jsx(T,{variant:"outlined",onClick:q,sx:{marginLeft:"8px"},children:c.cancel})]})]}):r.jsx(r.Fragment,{children:(M==null?void 0:M.cardinality)!==0&&r.jsx(T,{variant:"contained",onClick:q,children:c.back})})})]}),r.jsx(r.Fragment,{children:!1})]}):r.jsx("div",{style:{padding:"50px"},children:r.jsx(N,{title:c.loadingData})})})},it=d.lazy(()=>S(()=>import("./Settings-1.0.7-74726933.js"),["./Settings-1.0.7-74726933.js","./main-1.0.7.js","./main-1.0.7-9bcf9658.js","./iconBase-1.0.7-dd244ceb.js","./main-1.0.7-ca6efa15.css","./AdminTheme-1.0.7-e1a0758c.js","./useMetadataColumns-1.0.7-004f6707.js","./useStoreTable-1.0.7-4bf15352.js","./index.esm-1.0.7-c2078752.js","./ActionsDml-1.0.7-c9050d88.js","./index.esm-1.0.7-50dfbcc7.js","./TextField-1.0.7-db52d17f.js","./Close-1.0.7-d2499b42.js","./MenuItem-1.0.7-c593e11a.js","./index-1.0.7-22a4f547.js","./useTableUpdater-1.0.7-8b30420d.js","./Stepper-1.0.7-be2bc3e5.js","./settings-1.0.7-0ed115b6.js","./FormControlLabel-1.0.7-e4e2218b.js","./DialogContent-1.0.7-fca1f4d6.js","./Tabs-1.0.7-766143ea.js","./settings-1.0.7-5a196fc8.css","./Checkbox-1.0.7-e4c93e2e.js","./AccordionSummary-1.0.7-07dc4067.js","./useSlot-1.0.7-9849c4eb.js","./PremiumFeature-1.0.7-7accbda7.js","./EnumTypeEnum-1.0.7-7ffcf33a.js","./ScopeEnum-1.0.7-801b5acc.js","./RadioGroup-1.0.7-a99aad94.js","./Radio-1.0.7-a1fc902e.js","./Link-1.0.7-7fd9c9be.js","./CssUnitTextField-1.0.7-44bdec8f.js","./useApp-1.0.7-3c86de8d.js","./ActionsApp-1.0.7-d5341f25.js","./ActionsExplorer-1.0.7-4d40ab8a.js","./DefaultWhere-1.0.7-5a862d59.js","./ThemeSettings-1.0.7-6837640e.js","./index-1.0.7-2cb350a7.js"],import.meta.url)),re=({appId:t,primaryKey:u,formMode:f,showTable:x,showForm:w,metaData:j,detailKey:C,selectionForm:g})=>{o.debug(t,u,f,j,C,g);const E=Ze(),R=d.useMemo(()=>{},[]);o.debug("relationAppId",R);const h=()=>null,b=()=>null,P=()=>null;return r.jsxs(r.Fragment,{children:[g===!0?r.jsx(r.Fragment,{children:h()}):r.jsx(st,{appId:t,primaryKey:u,formMode:f,showTable:x,showForm:w,detailKey:C,relationAppId:R,children:b()}),Be(j)&&r.jsx($e,{theme:E,children:r.jsx(d.Suspense,{fallback:r.jsx(N,{title:"Loading form settings..."}),children:r.jsx(it,{appId:t})})}),P()]})},U=Object.freeze(Object.defineProperty({__proto__:null,FormContainer:re,default:re},Symbol.toStringTag,{value:"Module"}));export{U as F,tt as a,p as d,et as u};
